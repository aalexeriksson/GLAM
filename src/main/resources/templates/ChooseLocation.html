<!DOCTYPE html>

<html>

<head>
	<script type="text/javascript"
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaDSEXBIq9OvQbY9CyAHJ8zpVsSaIcvtM&libraries=places"></script>
	<link rel="stylesheet" href="../static/style.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
<script>
    var map;
var marker;

navigator.geolocation.getCurrentPosition(success, failure);

function success(position) {
var currentDate = new Date();
var time = currentDate.getHours() + ":" + currentDate.getMinutes() + ":" + currentDate.getSeconds();
var date = currentDate.getDate() + "/" + (currentDate.getMonth() + 1) + "/" + currentDate.getFullYear();
    var myLat = position.coords.latitude;
    var myLong = position.coords.longitude;
    position[0]=myLat;
    position[1]=myLong;

    var coords = new google.maps.LatLng(position[0], position[1]);

    var mapOptions = {
        zoom: 16,
        center: coords
    }

            document.getElementById('latitude').value = myLat;
            document.getElementById('longitude').value = myLong;
            document.getElementById('date').value = date;
            document.getElementById('time').value = time;


    var map = new google.maps.Map(document.getElementById('map'), mapOptions);

    var marker = new google.maps.Marker({
        animation: google.maps.Animation.DROP,
        map: map,
        position: coords
    });


var geocoder = new google.maps.Geocoder;
        var infowindow = new google.maps.InfoWindow;

          geocodeLatLng(geocoder, map, infowindow, marker);

function geocodeLatLng(geocoder, map, infowindow, marker) {
 geocoder.geocode({'location': coords}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              infowindow.setContent(results[0].formatted_address);
              infowindow.open(map, marker);
              document.getElementById('location').value = results[0].formatted_address;

              console.log(results[0].formatted_address);

            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });
      }


    }

    function failure() {
        $('body').innerHTML("<p>Failure</p>");
    }



function initialize() {
       var currentDate = new Date();
        var time = currentDate.getHours() + ":" + currentDate.getMinutes() + ":" + currentDate.getSeconds();
       var date = currentDate.getDate() + "/" + (currentDate.getMonth() + 1) + "/" + currentDate.getFullYear();
    var input = document.getElementById('location');
    var autocomplete = new google.maps.places.Autocomplete(input);
    google.maps.event.addListener(autocomplete, 'place_changed', function () {
        var place = autocomplete.getPlace();
        var latlng = {lat: myLat, lng: myLong};


        var myLat = place.geometry.location.lat();
        var myLong = place.geometry.location.lng();
        position[0]=myLat;
        position[1]=myLong;

         document.getElementById('latitude').value = myLat;
         document.getElementById('longitude').value = myLong;
         document.getElementById('date').value = date;
         document.getElementById('time').value = time;


         var coords = new google.maps.LatLng(position[0], position[1]);

        var mapOptions = {
            zoom: 16,
            center: coords
        }

        map = new google.maps.Map(document.getElementById('map'), mapOptions);

        marker = new google.maps.Marker({
            animation: google.maps.Animation.DROP,
            map: map, position: coords
        });
var geocoder = new google.maps.Geocoder;
        var infowindow = new google.maps.InfoWindow;

          geocodeLatLng(geocoder, map, infowindow, marker);

function geocodeLatLng(geocoder, map, infowindow, marker) {
 geocoder.geocode({'location': coords}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              infowindow.setContent(results[0].formatted_address);
              infowindow.open(map, marker);
              document.getElementById('location').value = results[0].formatted_address;

              console.log(results[0].formatted_address);

            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });
      }



    });
}
google.maps.event.addDomListener(window, 'load', initialize);



  </script>

<nav class="navbar navbar-light" id="navBarColor">
	<div>
		<img class="float-right" id="navBarLogo" src="../static/logoWtext.png" width="30%" height="30%" alt="logo">
	</div>
</nav>

<div class="container-fluid">
	<h3>Choose location where suspicious event occurred</h3>

	<div>
		<input id="location" type="text" size="50" placeholder="Enter address or click current location below"
               autocomplete="on" runat="server" />
               <br>
                <input id="latitude" name="cityLat" placeholder="latitude"/>
                <br>
                <input id="longitude" name="cityLng" placeholder="longitude" />
                <br>
                <input id="time" name="time" placeholder="time" />
                <br>
               <input id="date" name="city2" placeholder="date" />

	</div>
	<br>

	<div id="map" style="height:500px; width:500px;"></div>

	<div class="card-footer text-muted mx-auto">
		<a href="#">Terms & Conditions</a>
	</div>
</div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>
</body>

</html>
