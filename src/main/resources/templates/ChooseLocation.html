<!DOCTYPE html>

<html>

<head>
	<script type="text/javascript"
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaDSEXBIq9OvQbY9CyAHJ8zpVsSaIcvtM&libraries=places"></script>
	<link rel="stylesheet" href="../static/style.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
<script>
    var map;
    var marker;

    navigator.geolocation.getCurrentPosition(success, failure);

    function success(position) {
        var myLat = position.coords.latitude;
        var myLong = position.coords.longitude;

        var coords = new google.maps.LatLng(myLat, myLong);

        var mapOptions = {
            zoom: 16,
            center: coords,
        }

        var map = new google.maps.Map(document.getElementById('map'), mapOptions);

        var marker = new google.maps.Marker({
            draggable: true,
            animation: google.maps.Animation.DROP, map: map, position: coords
        });

        marker.addListener('click', function toggleBounce() {
            if (marker.getAnimation() !== null) {
                marker.setAnimation(null);
            } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
            }
        });

         google.maps.event.addListener(marker, "click", function (e) {
            var infoWindow = new google.maps.InfoWindow({
                content: 'current location' });
            infoWindow.open(map, marker);
        });
        google.maps.event.addListener(map, 'click', function (e) {
            var infoWindow = new google.maps.InfoWindow({
                content: 'current location' });
            infoWindow.open(map, marker);           
        });


    }
    function failure() {
        $('body').innerHTML("<p>Failure</p>");
    }


    function initialize() {
        var input = document.getElementById('searchTextField');
        var autocomplete = new google.maps.places.Autocomplete(input);
        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            var currentDate = new Date();
            var month = currentDate.getMonth() + 1;
            var date = currentDate.getDate() + "/" + month + "/" + currentDate.getFullYear() + " " + currentDate.getHours() + ":" + currentDate.getMinutes() + ":" + currentDate.getSeconds();


            document.getElementById('city2').value = place.name;
            document.getElementById('cityLat').value = place.geometry.location.lat();
            document.getElementById('cityLng').value = place.geometry.location.lng();
            document.getElementById('time').value = "Time: " + date;


            var myLat = place.geometry.location.lat();
            var myLong = place.geometry.location.lng();


            var coords = new google.maps.LatLng(myLat, myLong);

            var mapOptions = {
                zoom: 16,
                center: coords,
            }

            map = new google.maps.Map(document.getElementById('map'), mapOptions);

            marker = new google.maps.Marker({
                draggable: true,
                animation: google.maps.Animation.DROP, map: map, position: coords
            });

            marker.addListener('click', function toggleBounce() {
                if (marker.getAnimation() !== null) {
                    marker.setAnimation(null);
                } else {
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                }
            });

             google.maps.event.addListener(marker, "click", function (e) {
                var infoWindow = new google.maps.InfoWindow({
                    content: 'current location'
                });
                infoWindow.open(map, marker);
            });
            google.maps.event.addListener(map, 'click', function (e) {
                var infoWindow = new google.maps.InfoWindow({
                    content: 'current location' });
                infoWindow.open(map, marker);
            });

        });
    }
    google.maps.event.addDomListener(window, 'load', initialize); 


  </script>

<nav class="navbar navbar-light" id="navBarColor">
	<div>
		<img class="float-right" id="navBarLogo" src="../static/logoWtext.png" width="30%" height="30%" alt="logo">
	</div>
</nav>

<div class="container-fluid">
	<h3>Choose location where suspicious event occurred</h3>

	<div>
		<input id="searchTextField" type="text" size="50" placeholder="Enter address or click current location below"
               autocomplete="on" runat="server" />
                <br>
                <input id="city2" name="city2" placeholder="address" />
                <br>
                <input id="cityLat" name="cityLat" placeholder="latitude"/>
                <br>
                <input id="cityLng" name="cityLng" placeholder="longitude" />
                <br>
                <input id="time" name="time" placeholder="time" />
                <br>
	</div>
	<br>

	<div id="map" style="height:500px; width:500px;"></div>

	<div class="card-footer text-muted mx-auto">
		<a href="#">Terms & Conditions</a>
	</div>
</div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>
</body>

</html>
